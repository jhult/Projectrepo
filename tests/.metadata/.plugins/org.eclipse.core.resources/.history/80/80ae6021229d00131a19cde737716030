package com.qa132.java;

import java.util.Set;
import java.util.concurrent.TimeUnit;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.support.ui.Select;
import org.testng.Assert;
import org.testng.annotations.AfterClass;
import org.testng.annotations.Test;

import com.opc.common.Browser;
import com.opc.common.Login;
import com.opc.locators.CloudHomePage;
import com.opc.locators.CloudMyServicePage;
import com.opc.locators.CloudSelectSignInPage;
import com.opc.util.Utility;
import com.safc.configuration.BaseTest;
import com.safc.configuration.BrowserType;
import com.safc.configuration.Config;

public class C9_EMGC_04_AccessJavaApplicationDeployed_Test extends BaseTest{
	WebDriver driver;
	Select select;
  
	   
  @Test(dataProvider = "browserType", dataProviderClass = BrowserType.class)
  public void test(String browserName)  {
	  
	  try{
		  
	  /* ----- Setting up the browser to run on -----*/ 
	  System.out.println(browserName);	  
	  driver = Browser.browserToRun(driver, browserName);
	  driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
	  
	  /* ----- Launch C9 site -----*/
	  driver.get(Config.APP_URL); 
	  driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
	  Thread.sleep(5000);
	  
	  /* ---------- SignIN to MyServices  ---------- */	   
	  Utility.myServicePage(driver);
	  
	  /* ----- Login to My service -----*/
	  Login.loginToMyService(driver, Config.USERID, Config.PASSWORD, Config.DOMAIN);
	  driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
	  Thread.sleep(5000);
	  
	     /*----- Verify Header on My services page  ------*/
      System.out.println(driver.findElement(By.xpath(".//*[@id='pt1:header:h:bb-center']/span[1]")).getText());
      Assert.assertTrue(driver.findElement(By.xpath(".//*[@id='pt1:header:h:bb-center']/span[1]")).getText().contains("My Services"), "My Services");
   
	  
	  /* ----- Navigating to Service -----*/	
	  Utility.selectPlatformService(driver, "java");
      driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
	  Thread.sleep(10000);

	  driver.findElement(By.xpath(".//*[@id='pt1:pt2:cb2']")).click();
	  driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
	  Thread.sleep(5000);
	 
	  /* ----- Navigating to Java Cloud Services Control Window -----*/
	  Set allWindowHandles = driver.getWindowHandles();
	  int win = allWindowHandles.size();
	  System.out.println("no. of windows open  "  + win);
	  String window1 = (String) allWindowHandles.toArray()[2];
	  driver.switchTo().window(window1);	
	  driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
	  driver.manage().window().maximize();
	  Thread.sleep(20000);
	  
	  System.out.println(driver.findElement(By.xpath(".//*[@id='emT:ch_fn_txt']")).getText());
	  Assert.assertEquals("Java Cloud Services Control", driver.findElement(By.xpath(".//*[@id='emT:ch_fn_txt']")).getText());
		
	  int n= driver.findElements(By.xpath(".//*[@id='emT:appsRegion:0:pcl1:appsTable:appNameCol']/div[2]")).size();
	  System.out.println("element values "+ n);

 
		/* ----- Run Application -----*/
	  
	    Utility.runApplicationName(driver, "application1");
	    driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
	    Thread.sleep(10000);

	    /* ----- Access Application -----*/
	   
	    /* ----- Navigating to Deployed Java Application Page -----*/
		  Set allWindowHandles1 = driver.getWindowHandles();
//		  int win = allWindowHandles.size();
		  String window2 = (String) allWindowHandles1.toArray()[3];
		  driver.switchTo().window(window2);	
		  driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
		  driver.manage().window().maximize();
		  Thread.sleep(5000);
		  
		  Assert.assertEquals( driver.findElement(By.xpath("//h1")).getText(), "Hello Index");
		
			

	    
  } catch(Exception err) { 
	 	 Assert.fail(err.getMessage());
	  } finally{   	 
	    	 
//	    	 driver.quit();
	     }
	  }
	   @AfterClass
	   public void testCleanUp()   {
	   //  Quit -closes all the open windows
	     driver.quit();
	   }
		   
	}
