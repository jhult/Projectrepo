package com.qa141.myaccount;

/* Test case to verify the Preference Setting in the  Dashboard page
 * Scenario taken for verification 
 * Login into the My Service
 * Verify the display of MY Service page using the header   
 *  set the preference and verify
 */

import java.util.Set;
import java.util.concurrent.TimeUnit;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.android.AndroidDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.safari.SafariDriver;
import org.openqa.selenium.support.ui.Select;
import org.testng.Assert;
import org.testng.annotations.AfterClass;
import org.testng.annotations.Test;

import com.opc.common.Browser;
import com.opc.common.Login;
import com.opc.locators.CloudHomePage;
import com.opc.locators.CloudMyServicePage;
import com.opc.locators.CloudSelectSignInPage;
import com.safc.configuration.BaseTest;
import com.opc.util.Utility;
import com.safc.configuration.BrowserType;
import com.safc.configuration.Config;
import com.safc.configuration.DbConnection;

public class C9_MYA_10_SetPreference_Test extends BaseTest{
	//	WebDriver driver, driver1;
	Select select;


	@Test(dataProvider = "browserType", dataProviderClass = BrowserType.class)
	public void test(String browserName) {

		try{  
			String ssopassword = DbConnection.readDataFromExcelFile(".\\data\\TestData.xls", "Sheet1", 1, 4)	;

			System.out.println("*-----Environment Used for testing------ *"+"\n"+Config.APP_URL +"\n" +"\n");
			System.out.println("Executing TestCase:-  " +  this.getClass().getSimpleName());	 
			System.out.println(browserName);

			driver = Browser.browserToRun(driver1, browserName);
			driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);

			driver.get(Config.APP_URL); 
			driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
			driver.manage().timeouts().pageLoadTimeout(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);


			Utility.myAccountPage(driver);
			driver.manage().timeouts().pageLoadTimeout(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);


			Login.ssoLogin(driver, "OPC-QA-CERT-IDC_ww@oracle.com", ssopassword);   
			driver.manage().timeouts().pageLoadTimeout(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
			driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
			Thread.sleep(10000);


			/*----- Verify Header on My Account Landing page  ------*/	      
			System.out.println("Header: -"+ driver.findElement(By.xpath(".//*[@id='pt1:header:h:macct-app-name']")).getText());     
			Assert.assertTrue(driver.findElement(By.xpath(".//*[@id='pt1:header:h:macct-app-name']")).getText().contains("My Account"), "My Account");


			/*-------Verify Preference------------------*/
			//click set Preference quick link		     
			driver.findElement(By.xpath(".//*[@id='pt1:header:h:otPre']")).click();
			driver.manage().timeouts().pageLoadTimeout(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
			Thread.sleep(20000);
			System.out.println(" window opened verified");
			
			/* ----- Navigating to My Services Window ----- */
			/* ----- Navigating to My Services Window -----*/
			Set allWindowHandles = driver.getWindowHandles();
			int win = allWindowHandles.size();
			System.out.println("no. of windows open  "  + win);
			String window1 = (String) allWindowHandles.toArray()[1];
			//System.out.println("windows title  "  + (String) allWindowHandles.toArray()[1]);
			driver.switchTo().window(window1);	
			driver.manage().timeouts().implicitlyWait(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS); 
			driver.manage().timeouts().pageLoadTimeout(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
			Thread.sleep(10000);
			

			//verify title
			System.out.println("Page title:"+driver.getTitle());
			System.out.println("pop up title:"+driver.findElement(By.xpath(".//*[@id='pt1:header:h:j_id_id142pc3']/span[1]")).getText());	 
			Assert.assertTrue(driver.findElement(By.xpath(".//*[@id='pt1:header:h:j_id_id142pc3']/span[1]")).getText().contains("Preferences"));
			System.out.println("Title verified");





			/*---verify the Cancel button------*/	
			System.out.println("Button label:"+driver.findElement(By.xpath(".//*[@id='pt1:header:h:cancel']")).getText());
			Assert.assertTrue(driver.findElement(By.xpath(".//*[@id='pt1:header:h:cancel']")).getText().contains("Cancel"));
			System.out.println("Button label verified");

			/*----- Verify Ok------*/	 

			System.out.println("Button label:"+driver.findElement(By.xpath(".//*[@id='pt1:header:h:ok']")).getText());
			Assert.assertTrue(driver.findElement(By.xpath(".//*[@id='pt1:header:h:ok']")).getText().contains("OK"));
			System.out.println("Button label verified");

			driver.findElement(By.xpath(".//*[@id='pt1:header:h:ok']")).click();
			driver.manage().timeouts().pageLoadTimeout(Config.WAIT_FOR_SECONDS, TimeUnit.SECONDS);
			Thread.sleep(20000);
			System.out.println(" return to service window ");


			/*----- Verify Header on My Account Landing page  ------*/	      
			System.out.println("Header: -"+ driver.findElement(By.xpath(".//*[@id='pt1:header:h:macct-app-name']")).getText());     
			Assert.assertTrue(driver.findElement(By.xpath(".//*[@id='pt1:header:h:macct-app-name']")).getText().contains("My Account"), "My Account");




		} catch(Exception err) { 
			Assert.fail(err.getMessage());
		}
	}
	@AfterClass

	public void testCleanUp()   {
		//  Quit -closes all the open window
		driver.quit();

	}
}
